# Die Basics zur Datenanalyse

## üì¢ Zielsetzung dieser Einheit {.unnumbered}

Am Beginn dieser Einheit werden zun√§chst die unterschiedlichen **Phasen** eines idealtypischen **Analyseprozesses** dargelegt. Danach schauen wir uns an, wie ein solcher Analyseprozess mit den **Tools R und RStudio** gelingen kann. dazu werden in einem ersten Schritt die Grundlagen des **Datenhandlings** mittels R behandelt.

------------------------------------------------------------------------

## Daten analysieren - aber wie?

Unabh√§ngig von der gew√§hlten Fragestellung bestehen Datenanalysen aus einer Abfolge unterschiedlicher **Arbeitsschritte**:

![Ein idealtyptischer Analyseworkflow](images/workflow_v1_cr.jpg){.videoframe .fullscreen-enabled}

Dieser idealtypische Workflow muss dabei nicht zwingend linear durchlaufen werden. Die Farbgebung in obiger Darstellung deutet bereits an, dass wir in diesem Prozess drei gro√üe Abschnitte unterscheiden k√∂nnen:

1.  Die initiale **Datenbeschaffung**
2.  Die **Aufbereitung und Analyse** dieser Daten
3.  Die **Dokumentation** der erzeugten Daten und Ergebnisse

## Die Hilfsmittel R & RStudio

Um den zuvor beschriebenen Analyseprozess auch umzusetzen reichen theoretisch Stift und Papier. Praktisch kann man dazu aber auf ein breites Angebot an [Software L√∂sungen](https://de.wikipedia.org/wiki/Liste_von_Statistik-Software) zur√ºckgreifen. F√ºr eine [am Grundsatz der Offenheit orientierten Forschung](https://de.wikipedia.org/wiki/Offene_Wissenschaft) werden wir uns in weiterer Folge mit der [Programmiersprache R](https://de.wikipedia.org/wiki/R_(Programmiersprache)) auseinandersetzen. Einige rahmende Ausf√ºhrungen zu R finden sich hier:

```{r echo=FALSE}
mySlideshow <- "eh6-1_r_basics_v1"
mySlideWidth <- 600
mySlideHeight <- 450

knitr::asis_output(paste(
  "<iframe src=\"https://kamihoeferl.at/lehre/vu_sozwiss_1/___slides/",
  mySlideshow,
  ".html#1\" width=\"",
  mySlideWidth,
  "px\" height=\"",
  mySlideHeight,
  "px\" class=\"videoframe\" allowfullscreen>Your browser doesnot support iframes <a href=\"<https://kamihoeferl.at/lehre/vu_sozwiss_1/___slides/",
  mySlideshow,
  ".html#1\">click here to view the page directly.</a></iframe>", sep = ""))
knitr::asis_output(paste(
  "<div><a href=\"https://kamihoeferl.at/lehre/vu_sozwiss_1/___slides/",
  mySlideshow,
  ".pdf\">Die Slides als PDF</a></div><br>",
  sep = ""))
```


üëâ Interessierte m√∂chte ich an dieser Stelle auf Walter Grubers [**"Reinf√ºhrung in RStudio"**](https://wgruber.github.io/R-Intro/aufbau-des-kurses.html#allgemeines) aufmerksam machen, die einen kurzweiligen √úberblick auf die Entstehung der Programmiersprache R (und noch viel mehr) bietet.

Um den Umgang mit **R komfortabler** zu gestalten, kann auf sgn. integrierte Entwicklungsumgebungen ("integrated development environment - IDE") zur√ºckgegriffen werden. Klingt technisch, hei√üt praktisch lediglich dass IDEs wie [**RStudio**](https://de.wikipedia.org/wiki/RStudio) helfen, Analyseprozesse mit R √ºbersichtlicher umzusetzen. Lukas Burk und Tobias Anton bieten in ihrer lesenswerten Einf√ºhrung ["R f√ºr Psychos"](https://r-intro.tadaa-data.de/book/) eine [**gelungene Einf√ºhrung in RStudio**](https://r-intro.tadaa-data.de/book/orientierung.html#rstudio) an. Kurz und gut: Lesen Sie bitte diese Einf√ºhrung in RStudio dort nach.

## Grundlegende Datenstrukturen in R

------------------------------------------------------------------------

**‚è≥ Work in Progress ‚è≥***

**üîΩ[Till then: Download it here](06_basic_datatypes_v1.R)üîΩ**

------------------------------------------------------------------------





## Daten im- und exportieren

Der Im- und Export von Daten ist zentraler Bestandteil jeder Datenanalyse. R und RStudio bieten dazu die unterschiedlichsten M√∂glichkeiten, von denen wir uns einige n√§her ansehen wollen.

**Ein Hinweis:** Da R skriptbasiert ist, m√ºssen die zu Locations der zu im- oder portierenden Datens√§tze als absolute oder meist als relative Pfadangaben gesetzt werden. Um dieses Referenzieren von Datens√§tzen einheitlicher zu gestalten, empfiehlt es sich, seinen Projekten folgende Minimalstruktur zu verpassen:

    Projektfolder
    | skript_1.R
    | ...
    | skript_n.R    
    |
    +-- data
        | datensatz_1.csv
        | ...
        | datensatz_n.csv

Verweise auf Datens√§tze beginnen damit einheitlich mit "data". Ein Verweis auf datensatz_1.csv w√ºrde damit wie folgt aussehen: "data/datensatz_1.csv"

In den meisten F√§llen ist man - wie in dem obigen Beispiel - mit relativen Pfadangaben gut bedient. Dadurch kann bestehender Code leicht zwischen unterschiedlichen Systemen umgezogen werden.

### Der Datenimport

Nach dieser Einleitung wollen wir nun aber endlich Datens√§tze importieren. Was uns dazu noch fehlt? Daten!

**üîΩ[Ein paar √úbungsdatens√§tze zum Importieren finden sich hier.](data/data.zip)üîΩ**

Das ZIP-Archiv mit unseren √úbungsdaten entpacken wir in den Ordner "data".

Das Dateiformat **MS-Excel (XLSX)** ist wohl eines der bekanntesten. Der Import solcher Tabellenbl√§tter kann mit einer Vielzahl von Packages bewerkstelligt werden. Das **Package readxl** verzichtet dazu auf Java etc., was es zu einer leichten und schnellen L√∂sung macht.

```{r}
library(readxl)
xlsx.laender <- read_excel("data/laender.xlsx", sheet = "aut-de-ch")
xlsx.laender
```

Im Gegensatz dazu k√∂nnen im **Comma Sperated Values (CSV)** Format abgelegte Daten sehr gut auch ohne zus√§tzliche Packages mit den Befehlen read.csv und read.csv2 importiert werden: Ersterer geht von Beistrichen als Feldtrennzeichen und Punkten als Dezimaltrennzeichen, letzterer von Strichpunkten als Feldtrennzeichen und Beistrichen als Dezimaltrennzeichen.

```{r}
csv.laender <- read.csv2("data/laender.csv")
csv.laender
```

> üìö **Exkurs:**\
> Ein Klick auf ein Datenfile offenbart ein Feature namens "Import dataset ..." das ein einfaches graphisches Interface zur Voransicht der zu importierenden Datens√§tze bietet.

Der Import von CSV-Datens√§tzen kann auch direkt √ºber das **HTTP-Protokoll** angesto√üen werden. dazu ein kurzes Beispiel aus dem [COVID19-Dashboard](https://covid19-dashboard.ages.at) der [√ñsterreichischen Agentur f√ºr Ern√§hrungssicherheit (AGES)](https://www.ages.at/startseite/):

```{r}
CovidFaelle <- read.csv2("https://covid19-dashboard.ages.at/data/CovidFaelle_GKZ.csv",
                         encoding = "UTF-8",
                         dec = ".")
str(CovidFaelle)
```

Es k√∂nnen aber auch **"ausgefallenere" Formate** importiert werden: Eigentlich nicht so ausgefallen, daf√ºr weniger bekannt ist das R-eigene RDS-Format. Dieses bin√§re Format unterst√ºtzt die √úbergabe von Faktoren (= praktisch):

```{r}
rds.laender <- readRDS("data/laender.rds")
str(rds.laender)
```

√úber [Packages wie haven](https://cran.r-project.org/web/packages/haven/index.html) k√∂nnen auch die hauseigenen Formate anderer Statistikpakete - wie beispielsweise SPSS - eingelesen werden. Je nach Package werden dabei verschiedene Metadaten zu den einzelnen Variablen mit importiert:

```{r}
library(haven)
spsslaender <- read_sav("data/laender.sav")
str(spsslaender)
```

**Ein komplexerer Zugang zum Thema Datenimport:**\
Es k√∂nnen √ºber [Packages wie rvest](https://blog.rstudio.com/2014/11/24/rvest-easy-web-scraping-with-r/) auch einzelne HTML-Elemente aus Websites ausgelesen und importiert werden. Mit Code-Support der [R Psychos Lukas Burk und Tobias Anton](https://r-intro.tadaa-data.de/book/) kann man beispielsweise die [Rankings des World Happiness Reports 2020 aus Wikipedia](https://en.wikipedia.org/wiki/World_Happiness_Report) absaugen:

```{r BSP Wikipedia}
library(rvest)    # Schnittstelle zum http(s) Protokoll
library(dplyr)    # Grammar of Data Manipulation (vgl. "Tidyverse") -> "pipes"

happiness2020 <- read_html("https://en.wikipedia.org/wiki/World_Happiness_Report") %>%
  html_nodes("table") %>%   # liefert Lister aller table-Elemente
  .[11] %>%                 # 11tes table-Element (manuell ermittelt)
  html_table(header = NA, trim = TRUE, fill = TRUE) %>%
  .[[1]]                    # h√§? html_table liefert eine Liste von Dataframes, wir wollen davon den ersten
head(happiness2020)
```

### Der Datenexport

Und wie k√∂nnen Daten nun wieder exportiert werden?

Bevor wir unsere √úbungsdaten wieder exportieren, wollen wir noch flott zwei kleine Manipulationen vornehmen: Wir ermitteln f√ºr unsere kleine L√§ndersammlung die Bev√∂lkerungsdichte und ordnen die Spalten inhaltlich konsistenter an.

```{r BSP Manipulation}
# Bev√∂lkerungsdichte auf 2 Nachkommastellen genau ermitteln
rds.laender$bevdichte <- round((rds.laender$ew*1000)/rds.laender$area, 2)

# Spalten noch etwas inhaltlich konsistenter anordnen
rds.laender.ex <- rds.laender[, c("land", "area", "ew", "bevdichte", "eumitglied", "creditrating")]
rds.laender.ex
```

Diesen kleinen Dataframe wollen wir nun in unterschiedliche Formate exportieren - beispielsweise in ein **Excel-Sheet** mittels des [Packages writexl](https://cran.r-project.org/web/packages/writexl/writexl.pdf):

```{r}
library(writexl)
write_xlsx(rds.laender.ex, "data/myLaender.xlsx")
```

... oder als **CSV-Datei** (sicherheitshalber mit Angabe des Encodings):

```{r}
write.csv2(rds.laender.ex, "data/myLaender.csv", fileEncoding = "UTF-8")
```

... oder als **RDS-Datei**:

```{r}
saveRDS(rds.laender.ex, "data/myLaender.rds")
```

... oder als SAV-Datei f√ºr SPSS mittels des [haven-Packages](https://cran.r-project.org/web/packages/haven/index.html):

```{r}
write_sav(rds.laender.ex, "data/myLaender.sav")
```

... oder als reiner Text f√ºr die Zwischenablage:

```{r}
# V1: in die Console zum manuellen Kopieren
write.table(rds.laender.ex)
# V2: mit Tabulatoren als Feldtrennzeichen und keinen Zeilenbeschriftungen direkt in die Zwischenablage
write.table(rds.laender.ex, "clipboard", sep="\t", row.names=FALSE)
```

------------------------------------------------------------------------

üèÜ **Nun wissen wir, ...**

-   welche **Schritte** eine Datenanalyse ausmachen.
-   welche grundlegenden **Datenstrukturen** in R vorhanden sind.
-   wie wir unterschiedlichen **Skalenniveaus** in R abbilden k√∂nnen.
-   wie wir Datens√§tze **in R im- und aus R exportieren** k√∂nnen.

And now it's **time for some action** ...

![](images/cat_computer.gif){.videoframe width="250"}
